# 2.2 |  TCP/IP 4계층 모델

- 목차

---

# 계층 구조

### 인터넷 프로토콜 스위트(internet protocol suite)

> 인터넷에서 컴퓨터들이 서로 정보를 주고받는 데 쓰이는 프로토콜의 집
> 

![Untitled](2%202%20TCP%20IP%204%E1%84%80%E1%85%A8%E1%84%8E%E1%85%B3%E1%86%BC%20%E1%84%86%E1%85%A9%E1%84%83%E1%85%A6%E1%86%AF%20339ebfe1cf494250a24b863553f5ddfd/Untitled.png)

- 각 계층은 특정 계층이 변경되었을 때 다른 계층이 영향을 받지 않도록 **모듈** 구조로 설계되었다. (= 갱신 용이)
    
    e.g. 전송 계층에서 TCP를 UDP로 변경했다고 해서 인터넷 웹 브라우저를 다시 설치해야 하는 것은 아님
    
- 계속해서 갱신되는 복잡하고 커다란 시스템의 경우, 시스템의 다른 요소에 영향을 주지 않고 서비스 구현을 변화시키는 능력은 계층화의 중요한 이점이다.
- 프로토콜 계층화
    - 네트워크 설계자는 프로토콜(프로토콜을 구현하는 네트워크 HW/SW)을 계층으로 조직
    - 서비스 모델(Service Model)
        - 각 계층은 내부에서 어떤 동작을 수행
        - 직접 하위 계층의 서비스를 이용
    - 프로토콜 계층은 소프트웨어, 하드웨어 또는 둘의 통합으로 구현

<aside>
📌 《면접을 위한 CS 전공지식 노트》에서는 TCP/IP 4계층을 하향식으로 설명하고 있다.

</aside>

# 애플리케이션 계층(Application Layer)

> 웹 서비스, 이메일 등 서비스를 실질적으로 사람들에게 제공하는 계층
> 
> 
> 사용되는 프로토콜 : FTP, HTTP, SSH, SMTP, DNS 등
> 
- 애플리케이션 계층 프로토콜은 여러 종단 시스템에 분산되어 있음
- 한 종단 시스템에 있는 애플리케이션이 다른 종단 시스템에 있는 애플리케이션과 정보 패킷(메시지, message)을 교환하는 데 이 계층의 프로토콜을 사용
- 용어
    - **FTP** : 장치와 장치 간의 파일을 전송하는 데 사용되는 표준 통신 프로토콜
    - **SSH** : 보안되지 않는 네트워크에서 네트워크 서비스를 안전하게 운영하기 위한 암호화 네트워크 프로토콜
    - **HTTP** : WWW을 위한 데이터 통신의 기초이자, 웹 사이트를 이용하는 데 쓰는 프로토콜 (웹 문서 요청/전송)
    - **SMTP** : 전자 메일 전송을 위한 인터넷 표준 통신 프로토콜
    - **DNS** : 도메인 이름과 IP 주소를 매핑해주는 서버. 이를 통해 IP 주소가 바뀌어도 사용자들에게 똑같은 도메인 주소로 서비스할 수 있음

# 전송 계층(Transport Layer)

> 송신자와 수신자를 연결하는 통신 서비스를 제공
> 
> 
> 연결 지향 데이터 스트림 지원, 신뢰성, 흐름 제어 제공
> 
> 애플리케이션과 인터넷 계층 사이에 데이터가 전달될 때의 중계 역할
> 
> e.g. TCP, UDP
> 
- 패킷
    
    > 컴퓨터 네트워크에서 데이터를 전송하기 위한 단위
    > 
    > 
    > 일반적으로 하나의 데이터는 일정한 크기로 분할되어 패킷으로 전송됨
    > 
    
    특징
    
    1. **분할 가능** : 데이터를 일정한 크기로 분할할 수 있다. 이는 데이터 전송 시 발생할 수 있는 오류를 방지하고, 전송 속도를 향상시키는 데 도움이 된다.
    2. **재조립 가능** : 전송 과정에서 일부 패킷이 손실되거나 지연되더라도, 수신 측에서 이를 재조립하여 원래의 데이터로 복원할 수 있다.
    3. **헤더(Header) 포함** : 헤더에는 패킷의 목적지, 전송 경로, 전송 순서 등의 정보가 담겨 있다.
    4. **오류 검사** : 패킷 전송 시 오류가 발생할 수 있으므로, 헤더에는 오류 검사를 위한 정보가 포함되어 있다.
    5. **전송 속도 조절 가능** : 패킷의 전송 속도를 조절함으로써 네트워크 혼잡도를 줄이고 전송 효율을 높이는 데 도움이 된다.

## TCP

- 패킷 사이의 순서 보장
- 연결 지향 프로토콜 사용하여 연결
- 신뢰성 구축해서 패킷 수신 여부 확인
- **가상 회선 패킷 교환 방식** 사용

### 가상 회선 패킷 교환 방식

- 각 패킷에는 가상 회선 식별자를 포함
- 모든 패킷을 전송하면 가상 회선이 해제, 패킷들은 전송된 ‘순서대로’ 도착함

![Untitled](2%202%20TCP%20IP%204%E1%84%80%E1%85%A8%E1%84%8E%E1%85%B3%E1%86%BC%20%E1%84%86%E1%85%A9%E1%84%83%E1%85%A6%E1%86%AF%20339ebfe1cf494250a24b863553f5ddfd/Untitled%201.png)

## UDP

- 패킷 사이의 순서 보장하지 않음
- 패킷 수신 여부 확인하지 않음
- **데이터그램 패킷 교환 방식** 사용

### 데이터그램 패킷 교환 방식

- 패킷이 독립적으로 이동하며 최적의 경로를 선택하여 이동
- 하나의 메시지에서 분할된 여러 패킷은 서로 다른 경로로 전송될 수 있음
- 패킷이 도착한 순서가 다를 수 있음

![Untitled](2%202%20TCP%20IP%204%E1%84%80%E1%85%A8%E1%84%8E%E1%85%B3%E1%86%BC%20%E1%84%86%E1%85%A9%E1%84%83%E1%85%A6%E1%86%AF%20339ebfe1cf494250a24b863553f5ddfd/Untitled%202.png)

## TCP 연결/해제 과정

### 연결 |  3-웨이 핸드셰이크(3-way handshake)

![Untitled](2%202%20TCP%20IP%204%E1%84%80%E1%85%A8%E1%84%8E%E1%85%B3%E1%86%BC%20%E1%84%86%E1%85%A9%E1%84%83%E1%85%A6%E1%86%AF%20339ebfe1cf494250a24b863553f5ddfd/Untitled%203.png)

1. SYN(Synchronization, 연결 요청 플래그) 단계 : 클라이언트는 클라이언트의 ISN을 담아 SYN을 보냄
    - ISN(Initial Sequence Numbers) : 새로운 TCP 연결의 첫 번째 패킷에 할당된 임의의 시퀀스 넘버
2. SYN + ACK(Acknowledgement, 응답 플래그) 단계 : SYN을 수신한 서버는 클라이언트에게 서버의 ISN과 승인번호(클라이언트 ISN의 +1)를 보냄
3. ACK 단계 : 클라이언트는 승인번호(서버 ISN의 + 1)를 담아 ACK를 서버에 보냄
4. 클라이언트와 서버 사이에 신뢰성 구축

<aside>
📌 UDP는 신뢰성 구축 과정이 없음!

</aside>

### 연결 해제 |  4-웨이 핸드셰이크(4-way handshake)

![Untitled](2%202%20TCP%20IP%204%E1%84%80%E1%85%A8%E1%84%8E%E1%85%B3%E1%86%BC%20%E1%84%86%E1%85%A9%E1%84%83%E1%85%A6%E1%86%AF%20339ebfe1cf494250a24b863553f5ddfd/Untitled%204.png)

1. 클라이언트가 연결을 닫으려고 할 때 FIN으로 설정된 세그먼트를 보냄. 클라이언트는 FIN_WAIT_1 상태로 들어가고 서버의 응답 대기
2. 서버는 클라이언트로 ACK라는 승인 세그먼트를 보냄. 서버는 CLOSE_WAIT 상태에 들어감. 클라이언트가 세그먼트를 받으면 FIN_WAIT_2 상태에 들어감
3. 서버는 2번 단계가 일정 시간 지난 이후에 클라이언트에게 다시 FIN이라는 세그먼트를 보냄
4. 클라이언트는 TIME_WAIT 상태가 되고 다시 서버로 ACK를 보냄. 서버는 ACK를 받은 후 CLOSED 상태가 됨. 일정 시간 대기 후 클라이언트는 연결이 닫히고(CLOSED) 클라이언트-서버의 모든 자원 연결이 해제됨.
- TIME_WAIT의 존재 이유
    - 지연 패킷이 발생할 경우를 대비하기 위함
    - 두 장치가 연결이 닫혔는지 확인하기 위함

# 인터넷 계층(Internet Layer)

> 장치로부터 받은 네트워크 패킷을 IP 주소로 지정된 목적지로 전송하기 위해 사용되는 계층
> 
> 
> e.g. IP, ARP, ICMP
> 
- 패킷을 수신해야 할 상대의 주소를 지정하여 데이터를 전달
- 비연결형적인 특징 - 상대방이 제대로 받았는지에 대해 보장하지 않음
- ARP(Address Resolution Protocol)
    
    네트워크 계층 구조(e.g. 인터넷 IP 주소)와 링크 계층 구조(MAC 주소) 사이에 변환
    
- ICMP
    - 인터넷에서 오류 메시지를 전달하기 위한 프로토콜,

# 링크 계층(Link Layer)

> 전선, 광섬유, 무선 등으로 실질적 데이터를 전달하며, 장치 간에 신호를 주고받는 ‘규칙’을 정하는 계층 (네트워크 접근 계층)
> 

## 유선 LAN

- 프로토콜 : IEEE802.3
- 전이중화 통신 사용
- 전이중화 통신(full duplex)
    - 양쪽 장치가 동시에 송수신할 수 있는 방식
    - 데이터를 주고받을 때 송신로와 수신로를 구분함
    - 통신 과정에서 충돌 가능성을 고려하지 않아도 됨
    - 현대의 고속 이더넷의 통신 기반
- CSMA/CD
    - Carrier Sense Multiple Access with Collision Detection
    - 데이터를 보낸 이후 충돌이 발생하면 일정 시간 이후 재전송하는 방식
    - 데이터 송수신 과정에 한 경로를 사용하여 통신함
    - 통신 과정에 발생할 수 있는 통신 가능성을 고려

### 유선 LAN을 이루는 케이블

- 트위스트 페어 케이블
    
    
- 광섬유 케이블
    
    

## 무선 LAN

- 프로토콜 : IEEE802.11
- 반이중화 통신 사용
- 반이중화 통신(half duplex)
    - 양쪽 장치는 서로 통신할 수 있지만, **동시에는 통신할 수 없으며** **한 번에 한 방향만 통신**할 수 있는 방식
    - 충돌 방지 시스템이 필요함
- CSMA/CA
    - 반이중화 통신 중 하나
    - 데이터를 보내기 전에 캐리어 감지 등 사전에 가능한 한 충돌을 방지하는 방식 사용
        1. 데이터 송신 이전에 무선 매체 확인
        2. **캐리어 감지** : 회선이 비어 있는지를 판단
        3. **IFS(Inter FrameSpace)** : 랜덤 값을 기반으로 정해진 시간만큼 기다리며, 만약 무선 매체가 사용 중이면 점차 그 간격을 늘려가며 기다림
        4. 이후에 데이터를 송신

### 무선 LAN을 이루는 주파수

- 2.4GHz
    - 낮은 주파수
    - 전송 속도 ↓
    - 방해 요소 ↓
    - 커버리지 ↑
- 5GHz
    - 높은 주파수
    - 전송 속도 ↑
    - 방해 요소 ↑
    - 커버리지 ↓

### 와이파이(wifi)

- 전자기기들이 무선 LAN 신호에 연결할 수 있게 하는 기술
- 무선 접속 장치(AP, Access Point)가 있어야 사용 가능  ⇒ 공유기
- 유선 LAN 신호 → 무선 LAN 신호

### BSS(Basic Service Set)

- 기본 서비스 집합
- 단순 공유기를 통해 네트워크에 접속하는 것이 아닌 동일 BSS 내에 있는 AP들과 장치들이 서로 통신이 가능한 구조
- 근거리 무선 통신을 제공
- 사용자가 다른 곳으로 자유롭게 이동하며 네트워크에 접속하는 것은 불가능

### ESS(Extended Service Set)

- 하나 이상의 연결된 BSS 그룹
- 장거리 무선 통신을 제공, BSS보다 더 많은 가용성과 이동성을 지원
- 사용자는 한 장소에서 다른 장소로 이동하며 중단 없이 네트워크에 계속 연결 가능

### 이더넷 프레임

- **Preamble** : 이더넷 프레임이 시작임을 알림
- **SFD(Start Frame Delimiter)** : 다음 바이트로부터 MAC 주소 필드가 시작됨을 알림
- **DMAC, SMAC** : 수신, 송신 MAC 주소
- **EtherType** : 데이터 계층 위의 계층인 IP 프로토콜을 정의함. e.g. IPv4 또는 IPv6
- **Payload** : 전달받은 데이터
- **CRC** : 에러 확인 비트

<aside>
💡 **MAC 주소**

각 장치에 있는 네트워크에 연결하기 위한 장치(LAN 카드)를 구별하기 위한 식별번호 (6바이트 = 48비트)

</aside>

## 계층 간 데이터 송수신 과정

### 캡슐화 과정

> 상위 계층의 헤더와 데이터를 하위 계층의 데이터 부분에 포함시키고 해당 계층의 헤더를 삽입하는 과정
> 

![Untitled](2%202%20TCP%20IP%204%E1%84%80%E1%85%A8%E1%84%8E%E1%85%B3%E1%86%BC%20%E1%84%86%E1%85%A9%E1%84%83%E1%85%A6%E1%86%AF%20339ebfe1cf494250a24b863553f5ddfd/Untitled%205.png)

- 애플리케이션 계층의 데이터가 전송 계층으로 전달 → ‘세그먼트’ 또는 ‘데이터그램’화 되며 TCP(L4) 헤더가 붙여짐
- 전송 계층의 데이터가 인터넷 계층으로 전달 → IP(L3) 헤더가 붙여지며 ‘패킷’화됨
- 인터넷 계층의 데이터가 링크 계층으로 전달 → 프레임 헤더와 프레임 트레일러가 붙어서 ‘프레임’화가 됨

### 비캡슐화 과정

> 하위 계층에서 상위 계층으로 가며, 각 계층의 헤더 부분을 제거하는 과정
> 

![Untitled](2%202%20TCP%20IP%204%E1%84%80%E1%85%A8%E1%84%8E%E1%85%B3%E1%86%BC%20%E1%84%86%E1%85%A9%E1%84%83%E1%85%A6%E1%86%AF%20339ebfe1cf494250a24b863553f5ddfd/Untitled%206.png)

- 캡슐화 과정에서 역으로 진행되며, 최종적으로 사용자에게 애플리케이션의 PDU인 메시지로 전달됨

# =============================

# PDU(Protocol Data Unit)

> 네트워크의 한 계층에서 다른 계층으로 전달되는 프로토콜 데이터 단위
> 

<aside>
💡 제어 관련 정보들이 포함된 **’헤더’** + 데이터를 의미하는 **’페이로드’**

각 계층마다 부르는 방식이 다름

</aside>

- 애플리케이션 계층 : 메시지
- 전송 계층 : 세그먼트(TCP), 데이터그램(UDP)
- 인터넷 계층 : 패킷
- 링크 계층 : 프레임(데이터 링크 계층), 비트(물리 계층)